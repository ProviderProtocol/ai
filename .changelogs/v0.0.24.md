# v0.0.24 Changelog

## Reasoning / Extended Thinking Support

Full reasoning/extended thinking support across all providers with unified `ReasoningBlock` content type.

### New Content Type: `ReasoningBlock`

- [x] Added `ReasoningBlock` type for model reasoning/thinking content
- [x] Added `ContentBlockType.Reasoning` constant (`'reasoning'`)
- [x] Added `reasoning()` factory function
- [x] Added `isReasoningBlock()` type guard
- [x] Added `Message.reasoning` accessor for reasoning blocks

```ts
import { reasoning, isReasoningBlock, ContentBlockType } from 'upp';

// Create reasoning content
const block = reasoning('Let me think step by step...');

// Type guard
if (isReasoningBlock(block)) {
  console.log(block.text);
}

// Access reasoning from response
const reasoningBlocks = turn.response.reasoning;
```

### Provider-Specific Reasoning Support

#### Anthropic
- [x] Extended thinking with `thinking.budget_tokens` parameter
- [x] Thinking signature capture/forwarding for multi-turn context
- [x] Streaming `ReasoningDelta` events from `thinking_delta`
- [x] Signature delta handling (`signature_delta`)

```ts
const claude = llm<AnthropicLLMParams>({
  model: anthropic('claude-sonnet-4-20250514'),
  params: {
    max_tokens: 16000,
    thinking: {
      type: 'enabled',
      budget_tokens: 5000,
    },
  },
});
```

#### OpenAI
- [x] Reasoning models (o3-mini, o4-mini) with `reasoning.summary`
- [x] `encrypted_content` forwarding for multi-turn stateless mode
- [x] Streaming `response.reasoning_summary_text.delta` events
- [x] New types: `OpenAIReasoningOutput`, `OpenAIResponsesReasoningInputItem`

```ts
const gpt = llm<OpenAIResponsesParams>({
  model: openai('o3-mini'),
  params: {
    max_output_tokens: 4000,
    reasoning: {
      effort: 'medium',
      summary: 'detailed',
    },
  },
});
```

#### Google Gemini
- [x] `thinkingConfig` with `thinkingBudget`, `thinkingLevel`, `includeThoughts`
- [x] `thoughtSignature` capture/forwarding for multi-turn context
- [x] Streaming `ReasoningDelta` for thought parts (`thought: true`)
- [x] Gemini 2.5+ and 3+ model support

```ts
const gemini = llm<GoogleLLMParams>({
  model: google('gemini-2.5-flash'),
  params: {
    maxOutputTokens: 4000,
    thinkingConfig: {
      thinkingBudget: -1, // Dynamic
      includeThoughts: true,
    },
  },
});
```

#### Ollama
- [x] `think` parameter for reasoning models (DeepSeek-R1, Qwen 3, GPT-OSS)
- [x] `message.thinking` field extraction to `ReasoningBlock`
- [x] `<think>` tag stripping in multi-turn history

```ts
const model = llm<OllamaLLMParams>({
  model: ollama('deepseek-r1:7b'),
  params: {
    num_predict: 2000,
    think: true,
  },
});
```

#### X.AI (Grok)
- [x] `reasoning_effort` parameter for grok-3-mini (Completions API)
- [x] `reasoning_content` field extraction to `ReasoningBlock`
- [x] Messages API thinking blocks with signature forwarding
- [x] Responses API encrypted reasoning for multi-turn context
- [x] Streaming `response.reasoning_summary_text.delta` events

```ts
const grok = llm<XAICompletionsParams>({
  model: xai('grok-3-mini'),
  params: {
    max_tokens: 4000,
    reasoning_effort: 'high',
  },
});
```

### Multi-Turn Context Preservation

Reasoning context is automatically preserved across conversation turns via provider-specific metadata:

| Provider | Mechanism |
|----------|-----------|
| Anthropic | `thinkingSignature` / `thinkingSignatures[]` in metadata |
| OpenAI | `reasoningEncryptedContent` (JSON with id, summary, encrypted_content) |
| Google | `thoughtSignature` forwarded on text parts |
| X.AI Messages | `thinkingSignature` on thinking blocks |
| X.AI Responses | `reasoningEncryptedContent` (same as OpenAI) |

### Streaming Events

All providers emit `StreamEventType.ReasoningDelta` events during streaming:

```ts
for await (const event of stream) {
  if (event.type === StreamEventType.ReasoningDelta) {
    process.stdout.write(event.delta.text);
  }
}
```

## Other Changes

### SSE Buffer Limit Removed
- [x] Removed 1MB buffer limit from `parseSSEStream`
- [x] Simplified buffer handling (direct concatenation)

### Spec Updates
- [x] Added `ReasoningBlock` to UPP-1.2.spec.md
- [x] Updated `AssistantContent` union type
- [x] Added `ContentBlockType.Reasoning` constant documentation
- [x] Added JSON Schema definition for `ReasoningBlock`

### Tests
- [x] Added `tests/live/reasoning.live.test.ts` with comprehensive provider tests
- [x] Added `tests/unit/providers/reasoning.test.ts` for unit tests
