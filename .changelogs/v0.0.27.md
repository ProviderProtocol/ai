# v0.0.27 Changelog

## Proxy Provider Multi-Modality Support

Extended the proxy provider to transport embedding and image generation requests over HTTP. The proxy remains a pure transport layer - PP types go in, PP types come out.

### Features

- [x] New `createEmbeddingHandler()` for proxying embedding requests
- [x] New `createImageHandler()` for proxying image generation requests
- [x] Image handler supports `generate()`, `edit()`, and `stream()` operations
- [x] SSE streaming for real-time image generation events
- [x] Automatic base64 serialization/deserialization for binary image data

### Client Usage

```ts
import { proxy, embedding, image } from '@providerprotocol/ai/proxy';

const provider = proxy({ endpoint: 'https://your-server.com/api/ai' });

// Embeddings
const embeddingModel = embedding({ model: provider.embedding('text-embedding-3-small') });
const result = await embeddingModel.embed(['hello world']);

// Image generation
const imageModel = image({ model: provider.image('dall-e-3') });
const imageResult = await imageModel.generate({ prompt: 'A sunset over mountains' });

// Streaming image generation
const stream = imageModel.stream({ prompt: 'A sunset over mountains' });
for await (const event of stream) {
  console.log(event.type, event.data);
}
```

### Server Utilities

New parsing and response helpers for handling embedding and image requests:

```ts
import {
  parseEmbeddingBody,
  parseImageBody,
  toEmbeddingJSON,
  toImageJSON,
  toImageSSE,
} from '@providerprotocol/ai/proxy/server';

// Embedding endpoint
export async function handleEmbedding(req: Request) {
  const { inputs, model, params } = parseEmbeddingBody(await req.json());
  const result = await embeddingInstance.embed(inputs);
  return toEmbeddingJSON(result);
}

// Image endpoint
export async function handleImage(req: Request) {
  const { prompt, model, params, image, mask } = parseImageBody(await req.json());

  if (req.headers.get('accept')?.includes('text/event-stream')) {
    return toImageSSE(imageInstance.stream({ prompt }));
  }
  return toImageJSON(await imageInstance.generate({ prompt }));
}
```

### New Exports

From `@providerprotocol/ai/proxy`:
- `ProxyEmbeddingParams`
- `ProxyImageParams`

From `@providerprotocol/ai/proxy/server`:
- `parseEmbeddingBody()`
- `parseImageBody()`
- `toEmbeddingJSON()`
- `toImageJSON()`
- `toImageSSE()`
- `ParsedEmbeddingRequest`
- `ParsedImageRequest`

### Framework Adapters

All framework adapters (Express, Fastify, H3) updated with embedding and image support.

## Tests

- [x] Added `tests/live/proxy.modalities.live.test.ts`
- [x] Added `tests/unit/proxy/proxy-modalities.test.ts`
