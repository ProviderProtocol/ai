# v0.0.32 Changelog

## Partial JSON Streaming

- [x] New `ObjectDelta` stream event type for structured output responses
- [x] New `parsed` field on `EventDelta` for accessing partially parsed JSON during streaming
- [x] New `parsePartialJson()` utility for parsing incomplete JSON strings

```ts
import { StreamEventType } from '@providerprotocol/ai';

// When streaming with structured output, receive object_delta events
const stream = generateStream({
  model: anthropic('claude-sonnet-4-20250514'),
  prompt: 'Generate a user profile',
  structure: userSchema
});

for await (const event of stream) {
  if (event.type === StreamEventType.ObjectDelta) {
    // Access the partial object as it builds up
    console.log(event.delta.parsed);
    // { name: "John" } → { name: "John", age: 30 } → { name: "John", age: 30, email: "..." }
  }
}
```

### Partial JSON Parser

The parser handles common incomplete states during streaming:

```ts
import { parsePartialJson } from '@providerprotocol/ai/utils/partial-json';

// Incomplete string
parsePartialJson('{"name":"Jo');
// => { value: { name: "Jo" }, isComplete: false }

// Incomplete object
parsePartialJson('{"user":{"firstName":"John","age":');
// => { value: { user: { firstName: "John" } }, isComplete: false }

// Complete JSON
parsePartialJson('{"name":"John"}');
// => { value: { name: "John" }, isComplete: true }
```

### Tool Call Delta Enhancement

`toolCallDelta` events now include the `parsed` field for incremental tool argument parsing:

```ts
for await (const event of stream) {
  if (event.type === StreamEventType.ToolCallDelta) {
    // Raw JSON string
    console.log(event.delta.argumentsJson);

    // Partially parsed arguments object (new)
    console.log(event.delta.parsed);
  }
}
```

## Provider Updates

All providers now emit `object_delta` events when `request.structure` is set:

- [x] Anthropic
- [x] Google
- [x] Ollama
- [x] OpenAI (completions & responses)
- [x] OpenRouter (completions & responses)
- [x] xAI (completions, messages & responses)
- [x] Responses provider

## Tests

- [x] `tests/unit/utils/partial-json.test.ts` - partial JSON parser tests
- [x] `tests/unit/types/stream.test.ts` - stream event helper tests
