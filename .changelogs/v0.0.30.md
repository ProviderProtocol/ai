# v0.0.30 Changelog

## Ollama Native Tool Calling

- [x] Tool calling now enabled via native Ollama API
- [x] Tool call IDs use `{name}_{index}` format for multi-turn correlation
- [x] Streaming tool calls generate consistent IDs

```ts
import { llm } from '@providerprotocol/ai';
import { ollama } from '@providerprotocol/ai/ollama';

const model = llm({
  model: ollama('llama3.2'),
  tools: [{ name: 'search', description: '...', parameters: {...}, run: async () => {...} }]
});

// Tool call response now includes proper IDs
// { toolCallId: 'search_0', toolName: 'search', arguments: {...} }
```

## Google Native Function Call IDs

- [x] Uses API-provided `functionCall.id` when available
- [x] Falls back to synthetic `google_toolcall:{index}:{name}` when not provided
- [x] Preserves native IDs through multi-turn context
- [x] `TOOL_USE` finish reason normalizes to `tool_use`

## Tool Choice Passthrough

- [x] Anthropic: `tool_choice` param now preserved instead of defaulting to `auto`
- [x] xAI Messages: `tool_choice` param now preserved instead of defaulting to `auto`

```ts
// Force model to use a specific tool
const model = llm({
  model: anthropic('claude-sonnet-4-20250514'),
  params: {
    tool_choice: { type: 'tool', name: 'get_weather' }
  }
});

// Force model to use at least one tool
const model2 = llm({
  model: xai('grok-3', { api: 'messages' }),
  params: {
    tool_choice: { type: 'any' }
  }
});
```

## Base64 Encoding Standardization

- [x] All providers: Replaced `btoa()` with `Buffer.from().toString('base64')` for byte-to-base64 conversion
- [x] Affected: Anthropic, Google, Ollama, OpenAI, xAI, Responses

## xAI Live Search Removed

- [x] `search_parameters` removed from xAI types (was deprecated, removed Dec 2025)
- [x] Use Agent Tools with `web_search` instead

```ts
// Old (removed):
params: { search_parameters: { mode: 'auto', sources: ['web'] } }

// New:
import { llm, tools } from '@providerprotocol/ai';
import { xai } from '@providerprotocol/ai/xai';

const model = llm({
  model: xai('grok-4', { api: 'responses' }),
  params: {
    tools: [tools.webSearch()]
  }
});
```

## OpenRouter Improvements

- [x] Responses API streaming now includes `stream_options: { include_usage: true }`
- [x] Extended reasoning effort levels: `'xhigh'`, `'minimal'`, `'none'`

```ts
import { llm } from '@providerprotocol/ai';
import { openrouter } from '@providerprotocol/ai/openrouter';

const model = llm({
  model: openrouter('openai/o3-mini', { api: 'responses' }),
  params: {
    reasoning: { effort: 'xhigh' }
  }
});
```

## Tests

- [x] `tests/unit/providers/google-native-id.test.ts` - Native function call ID tests
- [x] `tests/unit/providers/ollama-tools.test.ts` - Ollama tool calling tests
- [x] `tests/unit/providers/tool-choice-passthrough.test.ts` - Tool choice passthrough tests
